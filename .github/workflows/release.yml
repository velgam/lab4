name: Deploy on Release
on: [release]
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: github-pages
    steps:
      - uses: actions/checkout@v4
      - run: |
          VERSION="${GITHUB_REF#refs/tags/}"
          echo "Deploying: $VERSION"
          
          # Создаем папку версии
          mkdir -p "versions/$VERSION"
          
          # Копируем файлы С ИХ СОДЕРЖИМЫМ
          cp -r en/ ru/ index.html "versions/$VERSION/"
          
          # ПРОВЕРЯЕМ что скопировалось
          echo "Files in versions/$VERSION/:"
          ls -la "versions/$VERSION/"
          echo "Files in versions/$VERSION/ru/:"
          ls -la "versions/$VERSION/ru/"
          
          # Обновляем versions.json
          if [ -f versions.json ]; then
            node -e "
            let v = require('./versions.json');
            if (!v.find(x => x.name === '$VERSION')) {
              v.unshift({name:'$VERSION', url:'versions/$VERSION', date:new Date().toISOString()});
              require('fs').writeFileSync('versions.json', JSON.stringify(v, null, 2));
            }
            "
          fi
      - uses: actions/upload-pages-artifact@v3
        with: { path: . }
      - uses: actions/deploy-pages@v4