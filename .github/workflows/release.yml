name: Deploy on Release
on: [release]
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: github-pages
    steps:
      - uses: actions/checkout@v4
      - run: |
          VERSION="${GITHUB_REF#refs/tags/}"
          echo "Deploying: $VERSION"
          
          # Create version folder
          mkdir -p "versions/$VERSION"
          cp -r en ru index.html "versions/$VERSION/"
          
          # Update versions.json
          if [ -f versions.json ]; then
            node -e "
            let fs = require('fs');
            let versions = JSON.parse(fs.readFileSync('versions.json'));
            if (!versions.find(v => v.name === '$VERSION')) {
              versions.unshift({
                name: '$VERSION',
                url: 'versions/$VERSION', 
                date: new Date().toISOString()
              });
              fs.writeFileSync('versions.json', JSON.stringify(versions, null, 2));
              console.log('Added: $VERSION');
            }
            "
          fi
      - uses: actions/upload-pages-artifact@v3
        with: { path: . }
      - uses: actions/deploy-pages@v4